# Schemathesis Configuration for OpenCitiVibes
# https://schemathesis.readthedocs.io/

# Target configuration
target:
  base_url: "${TARGET_API:-http://backend:8000}"
  schema_path: "/openapi.json"

# Testing strategy
strategy: "positive"  # positive, negative, or all

# Checks to run
checks:
  - not_a_server_error      # 5xx responses
  - status_code_conformance # Response matches spec
  - content_type_conformance
  - response_headers_conformance
  - response_schema_conformance
  - negative_data_rejection  # Invalid data should be rejected

# Hypothesis settings (fuzzing)
hypothesis:
  max_examples: 100          # Examples per endpoint (CI: 50, Full: 200)
  deadline: 30000            # 30 seconds per test
  suppress_health_check: true
  phases:
    - generate               # Skip reuse phase for faster runs

# Stateful testing
stateful:
  enabled: true
  mode: "links"              # Follow OpenAPI links

# Authentication
auth:
  type: "bearer"
  header: "Authorization"
  token_env: "AUTH_TOKEN"    # Set via environment variable

# Rate limiting
rate_limit:
  requests_per_second: 50

# Output settings
output:
  format: "json"
  include_request_body: true
  include_response_body: true
  max_response_size: 10000   # Truncate large responses

# Endpoints to exclude from testing
exclude:
  - "/health"
  - "/docs"
  - "/redoc"
  - "/openapi.json"

# Hooks (optional Python file for custom auth)
# hooks_file: "/app/config/schemathesis-hooks.py"
