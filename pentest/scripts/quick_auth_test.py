#!/usr/bin/env python3
"""Quick auth test to find working credentials."""

import requests

BASE = "http://127.0.0.1:8000/api"

# Try to create a user
print("Attempting to create test user...")
resp = requests.post(
    f"{BASE}/auth/register",
    json={
        "email": "pentest_retest@test.com",
        "username": "pentest_retest",
        "display_name": "Pentest Retest",
        "password": "Pentest123!@#"
    }
)
print(f"Register: {resp.status_code} - {resp.text[:200]}")

# Try to login with created user
if resp.status_code == 200:
    login = requests.post(
        f"{BASE}/auth/login",
        data={"username": "pentest_retest@test.com", "password": "Pentest123!@#"}
    )
    print(f"Login: {login.status_code} - {login.text[:200]}")
    if login.status_code == 200:
        print(f"TOKEN: {login.json().get('access_token', '')[:50]}...")

# Try to find existing users via leaderboard
print("\nChecking leaderboard for existing users...")
resp = requests.get(f"{BASE}/ideas/leaderboard?limit=3")
if resp.status_code == 200:
    ideas = resp.json()
    for idea in ideas:
        print(f"  Author: {idea.get('author_username')} (user_id: {idea.get('user_id')})")
